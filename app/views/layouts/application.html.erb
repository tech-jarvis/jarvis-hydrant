<!DOCTYPE html>
<html>
  <head>
    <title>Adopt a Hydrant</title>
    <%= stylesheet_link_tag "main" %>
    <%= javascript_include_tag "http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" %>
    <%= javascript_include_tag "http://maps.google.com/maps/api/js?sensor=false" %>
    <%= javascript_include_tag "snowstorm" %>
    <script type="text/javascript">
    $(function() {
      var map;
      var latlng = new google.maps.LatLng(<%= @lat %>, <%= @lng %>);
      var myOptions = {
        zoom: <%= @zoom %>,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
      var redMarker = '/images/markers/red.png';
      var greenMarker = '/images/markers/green.png';
      var openInfoWindow;
      var formString = '<%= render(:partial => "adoption_form").gsub("\n", "") %>'
<% @hydrants.each do |hydrant| %>
  <% if user = hydrant.user %>
      var contentString = '<%= render(:partial => "user_profile", :locals => {:user => user}).gsub("\n", "") %>'
  <% else %>
      var contentString = formString;
  <% end %>
      var h<%= hydrant.id %>LatLng = new google.maps.LatLng(<%= hydrant.lat %>, <%= hydrant.lng %>);
      var h<%= hydrant.id %>Marker = new google.maps.Marker({
          position: h<%= hydrant.id %>LatLng,
          map: map,
          icon: <%= hydrant.user_id ? "greenMarker" : "redMarker" %>
      });
      var h<%= hydrant.id %>InfoWindow = new google.maps.InfoWindow({
          content: contentString
      });
      google.maps.event.addListener(h<%= hydrant.id %>Marker, 'click', function() {
        if(openInfoWindow) {
          openInfoWindow.close();
        }
        h<%= hydrant.id %>InfoWindow.open(map, h<%= hydrant.id %>Marker);
        openInfoWindow = h<%= hydrant.id %>InfoWindow;
      });
<% end %>
      $('.box input[type="radio"]').live('click', function() {
        var self = $(this);
        if('new' == self.val()) {
          $('.forgot_password_fields').slideUp();
          $('.account_existing_fields').slideUp();
          $('.account_new_fields').slideDown();
        } else if('existing' == self.val()) {
          $('.account_new_fields').slideUp();
          $('.account_existing_fields').slideDown(function() {
            $('.forgot_password').click(function() {
              $('.account_existing_fields').slideUp();
              $('.forgot_password_fields').slideDown(function() {
                $('.remembered_password').click(function() {
                  $('.forgot_password_fields').slideUp();
                  $('.account_existing_fields').slideDown();
                });
              });
            });
          });
        }
      });
    })
    </script>
    <%= csrf_meta_tag %>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  </head>
  <body>
    <%= yield -%>
  </body>
</html>
